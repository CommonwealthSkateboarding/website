@(camp: models.skatepark.Camp)

@main("home") {

<section id="blog">
    <h2>Camp Detail Page</h2>
    <table class="table table-bordered table-striped table-condensed">
        <thead>
        <tr>
            <th>Camp</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Registration End Date</th>
            <th>Registrations</th>
            <th>Cost</th>
            <th>Schedule</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>@camp.title</td>
            <td>@camp.startDate.format("MM/dd/yyyy")</td>
            <td>@camp.endDate.format("MM/dd/yyyy")</td>
            <td>@camp.registrationEndDate.format("MM/dd/yyyy")</td>
            <td>@camp.registrations.size()/@camp.maxRegistrations</td>
            <td>@utils.Formatter.prettyDollars(camp.cost)</td>
            <td>@camp.scheduleDescription</td>
        </tr>
        </tbody>
    </table>

    @if(camp.registrations.size() < camp.maxRegistrations) {
        <br><br>
        <h2>Register for this camp now</h2>

        @******************************************
        * https://stripe.com/docs/tutorials/forms *
        ******************************************@

        <form action="@routes.Application.registerForCampWithStripe(camp.id)" method="POST" id="payment-form">
            <span class="payment-errors"></span>

            <div class="form-row">
                <label>
                    <span>Participant Name:</span>
                    <input id="name" name="name" type="text">
                </label>
            </div>
            <div class="form-row">
                <label>
                    <span>Billing Name:</span>
                    <input id="name" name="billingName" type="text">
                </label>
            </div>
            <div class="form-row">
                <label>
                    <span>Billing Email:</span>
                    <input id="email" name="email" type="text">
                </label>
            </div>
            <div class="form-row">
                <label>
                    <span>Card Number</span>
                    <input type="text" size="20" data-stripe="number"/>
                </label>
            </div>

            <div class="form-row">
                <label>
                    <span>CVC</span>
                    <input type="text" size="4" data-stripe="cvc"/>
                </label>
            </div>

            <div class="form-row">
                <label>
                    <span>Expiration (MM/YYYY)</span>
                    <input type="text" size="2" data-stripe="exp-month"/>
                </label>
                <span> / </span>
                <input type="text" size="4" data-stripe="exp-year"/>
            </div>

            <button type="submit">Register (@utils.Formatter.prettyDollars(camp.cost))</button>
        </form>
    }

    <br><br>
    <a href="@routes.Application.camp()">All Camps</a>
</section>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script>

    $(document).ready(function() {
        Stripe.setPublishableKey('pk_test_oVTabrtQ9C1eKjFwt94n4xdt');

        $('#payment-form').submit(function(event) {
            var $form = $(this);

            // Disable the submit button to prevent repeated clicks
            $form.find('button').prop('disabled', true);

            Stripe.card.createToken($form, stripeResponseHandler);

            // Prevent the form from submitting with the default action
            return false;
        });
        function stripeResponseHandler(status, response) {
          var $form = $('#payment-form');

          if (response.error) {
            // Show the errors on the form
            $form.find('.payment-errors').text(response.error.message);
            $form.find('button').prop('disabled', false);
          } else {
            // response contains id and card, which contains additional card details
            var token = response.id;
            // Insert the token into the form so it gets submitted to the server
            $form.append($('<input type="hidden" name="stripeToken" />').val(token));
            // and submit
            $form.get(0).submit();
          }
        };
        $("#dialog").dialog({
            autoOpen: false
        });
        $("#button").on("click", function() {
            $("#dialog").dialog("open");
        });

    });
</script>
}