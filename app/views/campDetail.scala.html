@(camp: models.skatepark.Camp)

@main("camp-detail") {

<section id="camp-detail">
    <h2>Camp Detail Page</h2>
    <table class="table table-bordered table-striped table-condensed">
        <thead>
        <tr>
            <th>Camp</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Registration End Date</th>
            <th>Registrations</th>
            <th>Cost</th>
            <th>Schedule</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>@camp.title</td>
            <td>@camp.startDate.format("MM/dd/yyyy")</td>
            <td>@camp.endDate.format("MM/dd/yyyy")</td>
            <td>@camp.registrationEndDate.format("MM/dd/yyyy")</td>
            <td>@camp.registrations.size()/@camp.maxRegistrations</td>
            <td>@utils.Formatter.prettyDollars(camp.cost)</td>
            <td>@camp.scheduleDescription</td>
        </tr>
        </tbody>
    </table>

    @if(camp.registrations.size() < camp.maxRegistrations) {
        <br><br>
        <h2>Register for this camp now</h2>

        @******************************************
        * https://stripe.com/docs/tutorials/forms *
        ******************************************@

        <form action="@routes.Application.registerForCampWithStripe(camp.id)" method="POST" id="payment-form">

            <script src="https://checkout.stripe.com/checkout.js"></script>

            <div class="form-row">
                <label>
                    <span>Participant Name:</span>
                    <input id="name" name="name" type="text">
                </label>
            </div>

            <button id="pay">Register and Pay</button>

            <script>
              var handler = StripeCheckout.configure({
                key: '@controllers.Stripe.STRIPE_PUBLIC_KEY',
                image: '@routes.Assets.at("img/cw--logo--lettermark-black.png")',
                token: function(token) {
                    var $form = $('#payment-form');
                    // Insert the token into the form so it gets submitted to the server
                    $form.append($('<input type="hidden" name="stripeToken" />').val(token.id));
                    $form.append($('<input type="hidden" name="stripeEmail" />').val(token.email));
                    // and submit
                    $form.get(0).submit();
                }
              });

              $('#pay').on('click', function(e) {
                handler.open({
                  name: 'Commonwealth Skate',
                  description: '@camp.title Registration (@utils.Formatter.prettyDollars(camp.cost))',
                  amount: @((camp.cost*100).intValue),
                  currency: 'usd',
                  bitcoin: true
                });
                e.preventDefault();
              });

              // Close Checkout on page navigation
              $(window).on('popstate', function() {
                handler.close();
              });
            </script>
        </form>
    }
    <br><br>
    <a href="@routes.Application.camp()">All Camps</a>
</section>
}